# Step 4: Investigation Package Analysis & Alert Resolution

After the detection rule is triggered and the VM is isolated, Microsoft Defender for Endpoint (MDE) automatically collects an investigation package. This step explains how to download, analyze, and extract value from that package.

---

## Objective

- Access and download the investigation package generated by MDE
- Understand the contents of the package
- Use findings to confirm suspicious behavior
- Resolve the alert and clean up the lab

---

## Accessing the Investigation Package

1. Log into the Microsoft Defender Portal: [https://security.microsoft.com](https://security.microsoft.com)

2. Go to:
```
Action Center → Investigation Packages
```

3. Find the most recent investigation task for your VM

4. Wait until the **Status** is "Completed"  
*(This may take a few minutes after the alert is triggered.)*

5. Click **Download Package**

---

## What's Inside the Investigation Package?

After extracting the `.zip` file, you’ll typically find:

| Artifact Category     | Description |
|-----------------------|-------------|
| `processlist.csv`     | List of running processes at the time of alert |
| `networkconnections.csv` | Active network connections |
| `autoruns.csv`        | Programs set to run at startup |
| `services.csv`        | All running services |
| `drivers.csv`         | Kernel-level drivers |
| `eventlogs.csv`       | Application, System, and Security logs |
| `registry.csv`        | Registry snapshot for persistence checks |
| `scheduledtasks.csv`  | Tasks scheduled on the system |

---

## How to Analyze It

Here are some places to look first:

- **processlist.csv**  
Look for suspicious PowerShell or cmd.exe commands, especially ones with long or obfuscated command lines.

- **autoruns.csv / scheduledtasks.csv**  
Check for strange or unexpected programs set to run automatically.

- **eventlogs.csv**  
Review recent Security and Application log entries. Look for Event ID 4104 (PowerShell Script Block Logging) if enabled.

- **registry.csv**  
Look for registry keys added or modified recently that might indicate persistence.

---

## Resolve the Alert

Once you’ve reviewed the data and confirmed that the alert was generated by your simulation:

1. Go to:
```
Incidents & Alerts → Alerts
````

2. Filter for your VM

3. Select your custom alert (`Potential PowerShell RCE Detected on VM`)

4. Assign it to yourself and mark it as **Resolved**

---

## Clean Up

- **Delete the Detection Rule**
- Go to: `Hunting → Custom Detection Rules`
- Select your rule and delete it to avoid accidental future isolations

- **Release the VM from Isolation**
- Navigate to:
 ```
 Assets → Devices → [Your VM]
 ```
- Click the three-dot menu (⋯) → **Release from Isolation**

---

## Outcome

At the end of this step, you've:

- Retrieved and reviewed forensic evidence from the VM
- Learned how to analyze the most critical parts of an investigation package
- Resolved the simulated security alert
- Cleaned up the environment

---

> In real-world scenarios, this process helps responders quickly triage alerts, identify malicious behavior, and determine next steps such as containment, remediation, or further analysis.
